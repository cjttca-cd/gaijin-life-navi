# 指南 & Knowledge 再設計 MEMO

> 作成: 2026-02-20
> ステータス: 討論中
> 参加者: Z + OC_ZG

---

## 背景

QA #27-35 完了 + 三層アクセス制御実装済み（`ba477ec`, `e4ecfc0`）の段階で、
指南コンテンツの「質」を根本的に見直す議論を開始。

## 核心の気づき

### 1. Knowledge ファイルの役割再定義

**現状の問題**: 既存の knowledge ファイル（24篇、計 ~126KB）の 7-8 割は
Claude の訓練データに既に含まれている一般知識の繰り返し。
「銀行の種類」「口座の種類」「税金の基本」等は書く意味がない。

**新しい方針**:
- Knowledge ファイルは **「モデルが知らない + 検索でも出てこない情報」だけ** を格納
- 具体的には: Z と実ユーザーの **実践経験・暗黙知・判断ロジック**
- 最新の具体的数字（手数料等）→ agent が `web_search` でリアルタイム取得
- 一般知識 → モデルのベース知識に任せる

### 2. 「指南」と「Knowledge」は別物（重要！）

ここで２つの概念を明確に分離する必要がある：

| | Knowledge（Agent用） | 指南（ユーザー用） |
|---|---|---|
| **読者** | AI Agent（svc-banking 等） | エンドユーザー（外国人住民） |
| **目的** | Agent の判断精度を上げる | ユーザーに直接読んでもらう |
| **内容** | 経験則、判断ロジック、隠れた注意点 | 体系的な手順、チェックリスト、図解 |
| **前提知識** | モデルのベース知識がある | ユーザーは予備知識ゼロの可能性 |
| **形式** | 簡潔なルール・Tips | 読みやすい記事形式 |
| **更新頻度** | 経験が増えたら随時 | 制度変更時に更新 |
| **格納場所** | `knowledge/`（agent workspace） | 別途管理（TBD） |

**→ 現状は両方を1つのファイルで兼用しているのが根本的な設計ミス。**

### 3. Agent の対話フローは問題なし（検証済み）

```
前端 _buildContext() — 最新から90Kトークン以内を逆順収集
  ↓ POST /chat { message, context: [{role, text}...] }
後端 chat.py — context_dicts + user_profile 構築
  ↓ call_agent()
agent.py — /reset + プロフィール + 履歴 + 新メッセージ を拼接
  ↓ openclaw agent --agent svc-banking
Agent — 完全な上下文で多輪対話可能
```

- 前端が履歴を送信 → 後端が拼接 → agent は多轮对话できる
- Agent は `web_search` + `web_fetch` を持っている → リアルタイム情報取得可能
- プロフィール（国籍/在留資格/地域/tier）→ パーソナライズ可能

---

## 採用方針: 三層情報アーキテクチャ（v2）

### 核心コンセプト: 三層漏斗

```
┌─────────────────────────────────────────────┐
│  Layer 1: Free 指南（ユーザー向けドキュメント）  │
│  "こういう事がある" — 概要だけ。手順なし          │
│  目的: SEO 引流 + 認知 + 登録導線               │
│  ※ 領域によって公開範囲が異なる                  │
│    例: 税務は free 指南なし（全 premium）         │
│        口座開設は概要だけ free                    │
└──────────────────┬──────────────────────────┘
                   │ 登録 + 有料化
┌──────────────────▼──────────────────────────┐
│  Layer 2: Premium 指南（ユーザー向けドキュメント） │
│  "どうやるか" — step-by-step、チェックリスト      │
│  目的: 付費転換の価値証明                        │
│  ※ ただし knowledge の全量は書かない              │
│    核心ノウハウは Layer 3 に留保                  │
└──────────────────┬──────────────────────────┘
                   │ AI Chat を使う
┌──────────────────▼──────────────────────────┐
│  Layer 3: AI 向導（Agent 経由のみアクセス）       │
│  "あなたの場合は具体的にこうすべき"               │
│  目的: 他 AI との差異化 = 核心壁壘               │
│  内容: Z の実践経験、判断ロジック、               │
│        パーソナライズされたアドバイス、             │
│        リアルタイム web search 結合              │
└─────────────────────────────────────────────┘
```

### 各レイヤーの特徴

| | Layer 1 (Free 指南) | Layer 2 (Premium 指南) | Layer 3 (AI 向導) |
|---|---|---|---|
| **形式** | 静的 markdown | 静的 markdown | 動的対話 |
| **読者** | 誰でも | 有料ユーザー | 有料ユーザー（Chat） |
| **内容の深さ** | "何がある" | "どうやる" | "あなたはこうすべき" |
| **パーソナライズ** | なし | なし | あり（プロフィール活用）|
| **最新性** | 手動更新 | 手動更新 | web search でリアルタイム |
| **ソース** | knowledge から生成 | knowledge から生成 | knowledge 直接参照 |

### 情報の出し分け例（Banking）

| トピック | Free 指南 | Premium 指南 | AI 向導のみ |
|---------|----------|-------------|------------|
| 銀行口座開設 | "外国人も口座開設できます。必要書類は..." | 銀行比較表、手順チェックリスト | あなたの国籍+ビザでの最適銀行、断られた時の対策 |
| 海外送金 | "複数の送金手段があります" | サービス比較表、基本手順 | あなたの送金先国での最安ルート（web search 併用） |
| 税金 | ❌ なし（全 premium） | 基本税目の説明、支払い方法 | あなたの在留年数・収入での具体的な税額試算、節税Tips |
| ATM/キャッシュレス | "コンビニATMが便利" | ATM手数料比較、おすすめ決済 | あなたの銀行×地域での最適ATM戦略 |

### ファイル構成（案）

```
svc-banking/workspace/
├── knowledge/                    ← Agent 専用（Layer 3）
│   ├── experience-tips.md        ← Z の実践経験・暗黙知
│   ├── decision-logic.md         ← 推薦ロジック・判断基準
│   └── routing-rules.md          ← Agent 内部ルーティング
│
├── guides/                       ← ユーザー向け指南（Layer 1+2）
│   ├── account-opening.md        ← access: public  (Layer 1)
│   ├── banks-overview.md         ← access: premium (Layer 2)
│   ├── remittance.md             ← access: premium (Layer 2)
│   ├── tax-payment.md            ← access: premium (Layer 2, free 指南なし)
│   ├── online-banking.md         ← access: premium (Layer 2)
│   └── faq.md                    ← access: public  (Layer 1)
```

### 生成フロー（一源生成 v2）

```
Step 1: Z が経験・暗黙知を提供
  ↓
Step 2: knowledge/*.md に整理（Agent 専用、Layer 3 の核心）
  ↓
Step 3: AI が knowledge + 分級ルール を元に指南を生成
  ↓     ├── free 指南: knowledge の概要レベルのみ抽出
  ↓     ├── premium 指南: 手順レベルまで展開。ただし核心Tips は省略
  ↓     └── 領域別 free/premium 境界はルールで制御
  ↓
Step 4: Z がレビュー → guides/*.md として格納
  ↓
Step 5: 多言語生成（EN/ZH/JA + 将来 KO/VI/PT）
```

### Agent AGENTS.md 改善ポイント

knowledge 分離に伴い、Agent の振る舞いも変える:
- knowledge/ の情報は **対話でのみ提供**（指南に書かない核心ノウハウ）
- ユーザーが指南で読める範囲の質問 → 指南を参照するよう誘導
- ユーザーが指南では得られない相談 → knowledge の判断ロジックでパーソナライズ回答
- 具体的数字は **web_search 必須**（knowledge にハードコードしない）

**メリット**:
- 維持コスト最小（knowledge 1 箇所だけ更新すればよい）
- Agent の知識と指南の一貫性が保証される
- 再生成可能（knowledge 更新 → 指南再生成）
- 多言語対応が生成時に自動
- **AI 向導と指南の明確な価値差異**が設計に組み込まれている

## TODO

### Phase 1: Banking Knowledge 再構築（現在ここ）
- [ ] Z の Banking 実践経験をヒアリング
- [ ] 既存 6 ファイルから「モデルが知らない情報」だけ抽出
- [ ] 新 knowledge ファイル作成（経験・判断ロジック中心）
- [ ] Agent AGENTS.md に web_search 活用ルールを追加
- [ ] 旧 knowledge ファイルの削除 or アーカイブ

### Phase 2: Banking 指南生成
- [ ] 生成ルール（free/premium の境界線）を定義
- [ ] knowledge → guides 変換プロンプトを作成
- [ ] AI で free/premium 指南を生成
- [ ] Z レビュー → 確定
- [ ] 多言語生成（EN/ZH）
- [ ] Navigator API の参照先を guides/ に切り替え

### Phase 3: 他ドメイン展開
- [ ] Visa 領域 — 同フレームワーク適用
- [ ] Medical 領域
- [ ] Concierge 領域

### Phase 4: Agent ルール改善（横断）
- [ ] 全 svc-* AGENTS.md に web_search 活用ルールを明記
- [ ] プロフィール活用ルールの強化

---

## 議論ログ

### 2026-02-20 13:55~
- Z: 既存指南の質をどう改善するか？
- OC: Banking をサンプルに全6篇を分析。一般知識の繰り返しが多いと指摘
- Z: 2 つの軸を指摘 — ①コンテンツ自体 ②Agent の判断ロジック
- Z: モデルが既に学習済みの情報を書く意味はない。具体的数字は web search でいい
- Z: 実践情報は Z が経験を提供できる
- OC: 対話履歴の多轮問題は front-end context 注入で解決済みと確認
- Z: **重要な気づき** — Knowledge（Agent 用）と指南（ユーザー用）は別概念
  - ユーザーはモデルのベース知識を持っていない
  - ユーザー向けには別途体系的な指南コンテンツが必要
- Z: 討論内容を memo に記録して、脱線時に参照できるようにしてほしい
- Z: もっとシンプルな方法 — knowledge を整備した後、AI に生成ルールを渡して free/premium の指南を自動生成すればいい
- → 「一源生成」モデルとして採用
- Z: 2 つの追加制約を指摘:
  1. **領域別に free/premium の境界が異なる** — 例: 税務は free 指南一切なし、全 premium
  2. **premium 指南にも knowledge の全量を書かない** — 核心ノウハウは AI 向導でのみ取得可能
  → 三層漏斗モデル（Free 指南 / Premium 指南 / AI 向導）に進化
- Z: ドキュメントと knowledge の分級・アーキテクチャ、Agent の提示词を全部再考する必要がある
- Z: まずフレームワークを確定 → 設計文档更新 → 実装 → 最後にコンテンツ整理。来回何度かイテレーションする前提
- Z: 3 つの重要な修正:
  1. Agent は guides/ を参照しない — knowledge + ベース知識 + web search だけで回答する（guides は Agent が書いたもの）
  2. 付費ユーザーへの AI 向導は「指南を読め」ではなく直接回答する。Free ユーザーにだけ升级案内
  3. knowledge 更新 → OpenClaw Agent が自動で guides/ を再生成するパイプライン
- → GUIDE_ACCESS_DESIGN.md を v2 に全面書き換え

---

*このメモは討論の進行に合わせて更新する。*
