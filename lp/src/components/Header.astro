---
import { locales, localeNames, getLocalePath, type Locale, type Translations } from '../i18n/index';

interface Props {
  t: Translations;
  locale: Locale;
}

const { t, locale } = Astro.props;
---

<header class="fixed top-0 left-0 right-0 z-50 bg-white/80 backdrop-blur-lg border-b border-gray-100">
  <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
    <!-- Logo -->
    <a href={getLocalePath(locale)} class="flex items-center gap-2 group">
      <div class="w-8 h-8 bg-gradient-to-br from-primary-500 to-accent-500 rounded-lg flex items-center justify-center">
        <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>
      <span class="font-bold text-lg text-gray-900 group-hover:text-primary-600 transition-colors">
        Gaijin Life Navi
      </span>
    </a>

    <!-- Desktop nav -->
    <div class="hidden md:flex items-center gap-6">
      <a href="#features" class="text-sm font-medium text-gray-600 hover:text-primary-600 transition-colors">
        {t.nav.features}
      </a>
      <a href="#download" class="text-sm font-medium text-gray-600 hover:text-primary-600 transition-colors">
        {t.nav.download}
      </a>

      <!-- Language Selector -->
      <div class="relative group">
        <button
          class="flex items-center gap-1.5 text-sm font-medium text-gray-600 hover:text-primary-600 transition-colors px-3 py-2 rounded-lg hover:bg-gray-50"
          aria-label={t.nav.langLabel}
        >
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
          </svg>
          {localeNames[locale]}
          <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
        <div class="absolute right-0 top-full mt-1 w-40 bg-white rounded-xl shadow-lg border border-gray-100 py-1 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
          {locales.map((loc) => (
            <a
              href={getLocalePath(loc)}
              class:list={[
                'block px-4 py-2 text-sm transition-colors',
                loc === locale
                  ? 'text-primary-600 bg-primary-50 font-medium'
                  : 'text-gray-700 hover:bg-gray-50 hover:text-primary-600',
              ]}
            >
              {localeNames[loc]}
            </a>
          ))}
        </div>
      </div>
    </div>

    <!-- Mobile menu button -->
    <button
      id="mobile-menu-btn"
      class="md:hidden p-2 rounded-lg text-gray-600 hover:bg-gray-50 transition-colors"
      aria-label="Menu"
    >
      <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
  </nav>

  <!-- Mobile menu -->
  <div id="mobile-menu" class="md:hidden hidden border-t border-gray-100 bg-white/95 backdrop-blur-lg">
    <div class="px-4 py-4 space-y-3">
      <a href="#features" class="block text-sm font-medium text-gray-600 hover:text-primary-600 py-2">
        {t.nav.features}
      </a>
      <a href="#download" class="block text-sm font-medium text-gray-600 hover:text-primary-600 py-2">
        {t.nav.download}
      </a>
      <div class="border-t border-gray-100 pt-3">
        <p class="text-xs font-medium text-gray-400 uppercase tracking-wider mb-2">{t.nav.langLabel}</p>
        <div class="flex flex-wrap gap-2">
          {locales.map((loc) => (
            <a
              href={getLocalePath(loc)}
              class:list={[
                'px-3 py-1.5 text-sm rounded-lg transition-colors',
                loc === locale
                  ? 'bg-primary-100 text-primary-700 font-medium'
                  : 'bg-gray-100 text-gray-600 hover:bg-gray-200',
              ]}
            >
              {localeNames[loc]}
            </a>
          ))}
        </div>
      </div>
    </div>
  </div>
</header>

<script>
  const btn = document.getElementById('mobile-menu-btn');
  const menu = document.getElementById('mobile-menu');
  btn?.addEventListener('click', () => {
    menu?.classList.toggle('hidden');
  });
  // Close on anchor click
  menu?.querySelectorAll('a[href^="#"]').forEach((a) => {
    a.addEventListener('click', () => menu?.classList.add('hidden'));
  });
</script>
